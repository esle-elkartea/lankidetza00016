<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:h="http://java.sun.com/jsf/html">
<body>

<ui:composition template="/facelet/templates/aon.ui.content.xhtml">

	<ui:define name="head">
		<ui:include src="/facelet/shared/head.xhtml" />
		<script type='text/javascript'
			src="${facesContext.externalContext.requestContextPath}/js/Calculations.js">
			// nothing
		</script>
		<script type='text/javascript'
			src="${facesContext.externalContext.requestContextPath}/js/itemLookup.js">
			// nothing
		</script>
		<script type='text/javascript'
			src="${facesContext.externalContext.requestContextPath}/js/ItemCreationLookup.js">
			// nothing
		</script>
		<script type='text/javascript'
			src="${facesContext.externalContext.requestContextPath}/js/CustomerLookup.js">
			// nothing
		</script>
		<script type='text/javascript'
			src="${facesContext.externalContext.requestContextPath}/js/SupplierLookup.js">
			// nothing
		</script>
		<script type='text/javascript'
			src="${facesContext.externalContext.requestContextPath}/js/SupportOrderLookup.js">
			// nothing
		</script>		
		<t:stylesheet path="/jscalendar-1.0/calendar-system.css" />
		<script type='text/javascript'
			src="${facesContext.externalContext.requestContextPath}/jscalendar-1.0/calendar.js">
			// nothing
		</script>
		<script type='text/javascript'
			src="${facesContext.externalContext.requestContextPath}/jscalendar-1.0/lang/calendar-es.js">
			// nothing
		</script>
		<script type='text/javascript'
			src="${facesContext.externalContext.requestContextPath}/jscalendar-1.0/calendar-setup.js">
			// nothing
		</script>
	</ui:define>

	<ui:define name="content">

		<h:form id="deliveryForm">

			<t:div styleClass="aon-content-toolbar" id="aon-content-toolbar"
				forceId="#{true}">
				<t:div styleClass="aon-content-toolbar-internal">
					<t:div styleClass="aon-content-toolbar-item-group">
						<t:commandButton id="save" value="#{bundle.aon_save}"
							actionListener="#{delivery.accept}" forceId="#{true}"
							rendered="#{delivery.editable}"
							onclick="return (confirm('#{bundle.aon_save_confirm}'))"
							styleClass="aon-content-toolbar-item aon-content-toolbar-item-save"
							onmouseover="this.className='aon-content-toolbar-item aon-content-toolbar-item-hover aon-content-toolbar-item-save'"
							onmouseout="this.className='aon-content-toolbar-item aon-content-toolbar-item-save'"
							disabled="#{deliveryDetail.to != null}"
							accesskey="#{bundle.aon_key_save}" />
						<t:commandButton id="cancel" value="#{bundle.aon_cancel}"
							forceId="#{true}" immediate="#{true}" action="delivery_list"
							actionListener="#{delivery.onCancel}"
							onclick="return (confirm('#{bundle.aon_cancel_confirm}'))"
							styleClass="aon-content-toolbar-item aon-content-toolbar-item-cancel"
							onmouseover="this.className='aon-content-toolbar-item aon-content-toolbar-item-hover aon-content-toolbar-item-cancel'"
							onmouseout="this.className='aon-content-toolbar-item aon-content-toolbar-item-cancel'"
							disabled="#{deliveryDetail.to != null}"
							accesskey="#{bundle.aon_key_cancel}" />
						<t:commandButton id="remove" value="#{bundle.aon_remove}"
							rendered="#{!delivery.new and delivery.editable }"
							forceId="#{true}" immediate="#{true}" action="delivery_list"
							actionListener="#{delivery.onRemove}"
							onclick="return (confirm('#{bundle.aon_remove_confirm}'))"
							styleClass="aon-content-toolbar-item aon-content-toolbar-item-delete"
							onmouseover="this.className='aon-content-toolbar-item aon-content-toolbar-item-hover aon-content-toolbar-item-delete'"
							onmouseout="this.className='aon-content-toolbar-item aon-content-toolbar-item-delete'"
							disabled="#{deliveryDetail.to != null}"
							accesskey="#{bundle.aon_key_remove}" />
						<t:commandButton id="reset" value="#{bundle.aon_reset}"
							rendered="#{!delivery.new}" action="delivery_form"
							actionListener="#{delivery.onReset}" forceId="#{true}"
							immediate="#{true}"
							styleClass="aon-content-toolbar-item aon-content-toolbar-item-new"
							onmouseover="this.className='aon-content-toolbar-item aon-content-toolbar-item-hover aon-content-toolbar-item-new'"
							onmouseout="this.className='aon-content-toolbar-item aon-content-toolbar-item-new'"
							disabled="#{deliveryDetail.to != null}"
							accesskey="#{bundle.aon_key_new}" />
						<t:commandButton id="search" value="#{bundle.aon_search}"
							forceId="#{true}" immediate="#{true}" action="delivery_search"
							actionListener="#{delivery.onEditSearch}"
							styleClass="aon-content-toolbar-item aon-content-toolbar-item-search"
							onmouseover="this.className='aon-content-toolbar-item aon-content-toolbar-item-hover aon-content-toolbar-item-search'"
							onmouseout="this.className='aon-content-toolbar-item aon-content-toolbar-item-search'"
							disabled="#{deliveryDetail.to != null}"
							accesskey="#{bundle.aon_key_search}" />
						<t:commandButton id="invoice"
							value="#{warehouseBundle.aon_to_invoice}" forceId="#{true}"
							rendered="#{!delivery.new and delivery.editable }"
							actionListener="#{salesInvoicing.onImportDelivery}"
							action="sales_invoicing_form"
							styleClass="aon-content-toolbar-item aon-content-toolbar-item-save"
							onmouseover="this.className='aon-content-toolbar-item aon-content-toolbar-item-hover aon-content-toolbar-item-save'"
							onmouseout="this.className='aon-content-toolbar-item aon-content-toolbar-item-save'"
							disabled="#{deliveryDetail.to != null}"
							accesskey="#{bundle.aon_key_invoice}" />
						<t:commandLink id="delivery" value="#{bundle.aon_report}" target="_new"
							rendered="#{!delivery.new}" forceId="#{true}"
							action="#{report.onExecute}"
							actionListener="#{delivery.onReport}"
							styleClass="aon-content-toolbar-item aon-content-toolbar-item-print"
							onmouseover="this.className='aon-content-toolbar-item aon-content-toolbar-item-hover aon-content-toolbar-item-print'"
							onmouseout="this.className='aon-content-toolbar-item aon-content-toolbar-item-print'"
							disabled="#{deliveryDetail.to != null}"
							accesskey="#{bundle.aon_key_print}" />
					</t:div>
				</t:div>
			</t:div>

			<t:div styleClass="aon-content-subtitle" id="aon-content-subtitle"
				forceId="#{true}">
				<t:div styleClass="aon-content-subtitle-internal">
					<h:outputText
						value="#{delivery.new?(bundle.aon_reset):(bundle.aon_editing)}" />
				</t:div>
			</t:div>

			<t:div id="aon-scroll-area" forceId="#{true}">
				<t:div styleClass="aon-scroll-area-internal">				
						<h:panelGrid columns="4" cellpadding="0" cellspacing="0"
							styleClass="aon-form-table" style="width:100%;"
							columnClasses="aon-form-table-column-odd,aon-form-table-column-even,aon-form-table-column-odd,aon-form-table-column-even">
							
						<!--  ROW -->
							<h:outputLabel for="Delivery_series"
								styleClass="aon-form-input-text-label"
								value="#{warehouseBundle.aon_series_number}" />
							<t:div>
									<t:inputText id="Delivery_series" value="#{delivery.to.series}"
									disabled="#{!delivery.new}"
									styleClass="aon-form-input-text" forceId="#{true}" size="3"
									maxlength="3" onblur="toUpperCase(this);" tabindex="1">
									<f:validateLength maximum="3" />
									</t:inputText>
									<t:inputText id="Delivery_number" value="#{delivery.to.number}"
									disabled="#{!delivery.new}"
									styleClass="aon-form-input-text" forceId="#{true}"
									required="true" size="7" tabindex="2"/>
							</t:div>
						<!-- FINISH  ROW -->
						
						<!--  ROW -->
							<t:outputLabel for="Delivery_status"
									styleClass="aon-form-selectOneMenu-label"
									value="#{warehouseBundle.aon_status}" />
							<h:selectOneMenu id="Delivery_status"
								styleClass="aon-form-selectOneMenu-field"
								value="#{delivery.to.status}" disabled="true">
								<f:selectItems value="#{warehouseCollections.deliveryStatuses}" />
							</h:selectOneMenu>
						
						<!-- FINISH  ROW -->
						
						<!--  ROW -->
							<h:outputLabel for="Delivery_issueTime"
							styleClass="aon-form-input-text-label"
							value="#{warehouseBundle.aon_date}" />
							<t:div>
								<t:inputText styleClass="aon-form-input-text"
									id="Delivery_issueTime" required="true" forceId="#{true}"
									value="#{delivery.to.issueTime}"
									disabled="#{!delivery.editable}" size="10" maxlength="12">
									<f:convertDateTime pattern="#{bundle.aon_date_pattern}"
										timeZone="#{timeZoneController.timeZoneId}" />
								</t:inputText>
								<t:commandButton styleClass="aon-form-lookup-button"
									id="Delivery_issueTime_button" forceId="#{true}" value=""
									immediate="true" disabled="#{!delivery.editable}" tabindex="3"/>
								<script type="text/javascript">
							  Calendar.setup( {
								inputField  : "Delivery_issueTime", button : "Delivery_issueTime_button",
								ifFormat    : "%d/%m/%Y" } );
								</script>								
							</t:div>
						<!-- FINISH  ROW -->
						
							<!--  ROW -->
							<t:outputLabel for="Delivery_securityLevel"
									styleClass="aon-form-selectOneMenu-label"
									value="#{warehouseBundle.aon_security_level}" />
							<h:selectOneMenu id="Delivery_securityLevel"
								styleClass="aon-form-selectOneMenu-field"
								value="#{delivery.to.securityLevel}"
								disabled="#{!delivery.editable}" tabindex="7">
								<f:selectItems value="#{financeCollections.securityLevels}" />
							</h:selectOneMenu>

						<!-- FINISH  ROW -->
						
						
						<!--  ROW -->
							<h:outputLabel for="SupportOrder_id"
								styleClass="aon-form-input-text-label"
								value="#{tasBundle.supportOrder_order}" />
							<t:div>
								<t:selectOneMenu id="SupportOrder_id" forceId="#{true}"
									disabled="#{!delivery.editable}"
									styleClass="aon-form-selectOneMenu-field"
									value="#{delivery.supportOrderId}"
									onchange="return validateAndLookup(this);"
									rendered="#{delivery.supportOrderId == null}" tabindex="4">
									<f:selectItem itemDisabled="true"
										itemLabel="#{commercialBundle.aon_select_support_order}"
										itemValue="" />
									<f:selectItems value="#{TASCollections.pendingSupportOrders}" />
								</t:selectOneMenu>
								<h:panelGrid columns="1"
									rendered="#{delivery.supportOrderId != null}">
									<t:outputText id="Id"
										value="#{tasDeliveryImport.supportOrderData}" />
								</h:panelGrid>
								<t:commandButton id="delivery"
									value="#{warehouseBundle.aon_import}" forceId="#{true}" styleClass="aon-navigation-link"
									disabled="#{!delivery.editable}"
									rendered="#{delivery.supportOrderId == null}"
									onclick="disableRequiredFields();"
									actionListener="#{tasDeliveryImport.importDelivery}" tabindex="5"/>
							</t:div>
						<!-- FINISH  ROW -->
						
						<!--  ROW -->
							<h:outputLabel for="SupportOrder_employee_id"
								styleClass="aon-form-input-text-label"
								value="#{tasBundle.supportOrder_employee}" />
							<t:selectOneMenu id="SupportOrder_employee_id"
								styleClass="aon-form-selectOneMenu-field" forceId="#{true}"
								value="#{delivery.employeeId}">
								<f:selectItem itemDisabled="true"
									itemLabel="#{commercialBundle.aon_select_employee}" itemValue="" />
								<f:selectItems value="#{employeeCollections.employees}" />
							</t:selectOneMenu>
						<!-- FINISH  ROW -->
					
						<!--  ROW -->
							<t:outputLabel for="Customer_id"
								styleClass="aon-form-input-text-label"
								value="#{warehouseBundle.aon_customer}" />
							<t:div>
								<t:inputText id="Customer_id" size="5" forceId="#{true}"
									disabled="#{delivery.supportOrderId != null or !delivery.editable}"
									styleClass="aon-form-input-text" required="true"
									onchange="return findCustomerLookup(event,'#{facesContext.externalContext.request.contextPath}','com.code.aon.sales.Customer');"
									value="#{delivery.to.customer.registry.id}"
									valueChangeListener="#{delivery.customerData}" />
								<h:commandButton id="findCustomer"
									rendered="#{delivery.supportOrderId == null}"
									onclick="selectWindow(this, 'placeList', '#{customerSearch.encodedPagePath}');return false;"
									value="" immediate="true" styleClass="aon-form-lookup-button"
									disabled="#{!delivery.editable}" tabindex="6"/>
								<h:commandButton id="addCustomer" 
									rendered="#{delivery.supportOrderId == null}"
									onclick="selectWindow(this, 'placeList', '#{customerAdd.encodedPagePath}');return false;"
									value="" immediate="true" styleClass="aon-form-new-button"
									disabled="#{!delivery.editable}" />
								<t:inputText id="Customer_full_name" forceId="#{true}"
									styleClass="aon-form-input-text-disabled" disabled="true"
									size="40"
									value="#{delivery.to.customer.registry.name} #{delivery.to.customer.registry.surname==null?' ':(delivery.to.customer.registry.surname)}" />
							</t:div>
						<!-- FINISH  ROW -->
						
						<!--  ROW -->	
							<h:outputLabel for="SupportOrder_description"
								styleClass="aon-form-input-text-label"
								value="#{tasBundle.supportOrder_description}" />
							<t:inputTextarea styleClass="aon-form-input-text"
								id="SupportOrder_description" forceId="#{true}"
								value="#{delivery.description}"
								cols="35" rows="3" readonly="true" tabindex="8">
							</t:inputTextarea>
						<!-- FINISH  ROW -->
						
						<t:outputLabel for="DeliveryDetail_warehouse_id"
							styleClass="aon-form-selectOneMenu-label"
							value="#{warehouseBundle.aon_warehouse}" />
						<h:selectOneMenu id="DeliveryDetail_warehouse_id" 
							disabled="#{!delivery.new and delivery.warehouseId != null}"
							styleClass="aon-form-selectOneMenu-field"
							value="#{delivery.warehouseId}">
							<f:selectItems value="#{warehouseCollections.warehouses}" />
						</h:selectOneMenu>
						
						<!--  ROW -->
						<t:outputLabel for="POS_id"
								styleClass="aon-form-selectOneMenu-label"
								value="#{warehouseBundle.aon_pos}" />
						<h:selectOneMenu id="POS_id"
							styleClass="aon-form-selectOneMenu-field"
							value="#{delivery.posId}"
							disabled="#{!delivery.editable}" >
							<f:selectItems value="#{salesCollections.pointsOfSale}" />
						</h:selectOneMenu>
						<!-- FINISH  ROW -->
					</h:panelGrid>

					<t:div styleClass="aon-form-group" rendered="#{!delivery.new}">
						<t:div styleClass="aon-form-group-title">
							<t:outputLabel for="deliveryLineData" rendered="#{!delivery.new}"
								value="#{warehouseBundle.aon_delivery_lines}" />
						</t:div>
						<t:div styleClass="aon-form-group-body">
							<t:dataTable id="deliveryLineDataList" var="to"
								styleClass="aon-edit-table" 
								headerClass="aon-edit-table-header"
								footerClass="aon-edit-table-footer" 
								value="#{deliveryDetail.model}"
								rowOnMouseOver="selectRow( this )"
								rowOnMouseOut="unselectRow( this )"
								rowOnClick="sendRow( this )"								
								rendered="#{!delivery.new}"				
								rowIndexVar="rowIndex" rows="20"
								rowClasses="aon-edit-table-row-odd,aon-edit-table-row-even"
								columnClasses="aon-edit-table-body aon-edit-table-body-icon,aon-edit-table-body aon-edit-table-body-string aon-edit-table-mainColumn,aon-edit-table-body aon-edit-table-body-number,aon-edit-table-body aon-edit-table-body-number,aon-edit-table-body aon-edit-table-body-number,aon-edit-table-body aon-edit-table-body-number,aon-edit-table-body aon-edit-table-body-buttons">

								<t:column styleClass="#{deliveryDetail.to==to?'aon-table-row-selected aon-edit-table-body aon-edit-table-body-icon':'aon-edit-table-body aon-edit-table-body-icon'}">
									<f:facet name="header">
										<f:verbatim>&#160;</f:verbatim>
									</f:facet>
		
									
									<t:commandLink styleClass="aon-table-row-selected"
										disabled="#{!delivery.editable}"
										rendered="#{to!=deliveryDetail.to}"
										actionListener="#{deliveryDetail.onSelect}" />
										
									<t:outputText value="#{deliveryDetail.model.rowIndex}"
										rendered="#{!deliveryDetail.new}" />
									<f:facet name="footer">
										<t:div>
											<t:commandButton value=""
												styleClass="aon-edit-table-icon-button aon-edit-table-icon-button-new"
												title="#{warehouseBundle.aon_newLine}"
												actionListener="#{deliveryDetail.onReset}"
												rendered="#{!deliveryDetail.new and delivery.editable}"
												accesskey="#{bundle.aon_key_new_line}" />
											<f:verbatim rendered="#{deliveryDetail.new}">&#160;</f:verbatim>
										</t:div>
									</f:facet>
								</t:column>

							

								<t:column styleClass="#{deliveryDetail.to==to?'aon-table-row-selected aon-edit-table-body aon-edit-table-body-string aon-edit-table-mainColumn':'aon-edit-table-body aon-edit-table-body-string aon-edit-table-mainColumn'}">
									<f:facet name="header">
										<h:outputText value="#{productBundle.item_item}" />
									</f:facet>
									<t:outputText value="#{to.description}"
										rendered="#{to!=deliveryDetail.to}" />

									<h:panelGroup rendered="#{to==deliveryDetail.to}">
										<t:commandButton id="popupButton" styleClass="aon-navigation-link"
										rendered="#{to==deliveryDetail.to}"
										value="#{purchaseBundle.aon_purchase}"
										onclick="showPopup();return false;" />
										
										<t:inputHidden id="Item_id-Edit" forceId="#{true}"
											value="#{deliveryDetail.to.item.id}"
											valueChangeListener="#{deliveryDetail.itemData}" />
										<t:inputText size="10" id="Item_product_code-Edit"
											required="true" forceId="#{true}"
											disabled="#{salesPurchase.to.purchaseDetail.id != null}"
											styleClass="aon-form-input-text"
											value="#{deliveryDetail.to.item.product.code}"
											onchange="return findItemLookup(event,'#{facesContext.externalContext.request.contextPath}','com.code.aon.product.Item','Item_id-Edit[#{rowIndex}],Item_product_code-Edit[#{rowIndex}],Item_full_name-Edit[#{rowIndex}],Item_price-Edit[#{rowIndex}]');" />
										<h:commandButton id="findInvoice_item"
											rendered="#{!salesPurchase.withPurchase}"
											onclick="selectWindow(this, 'placeList', '#{itemSearch.encodedPagePath}','Item_id-Edit[#{rowIndex}],Item_product_code-Edit[#{rowIndex}],Item_full_name-Edit[#{rowIndex}],Item_price-Edit[#{rowIndex}]');return false;"
											value="" immediate="true" styleClass="aon-form-lookup-button" />
										<h:commandButton id="addInvoice_item"
											rendered="#{!salesPurchase.withPurchase}"
											onclick="selectWindow(this, 'placeList', '#{itemAdd.encodedPagePath}','Item_id-Edit[#{rowIndex}],Item_product_code-Edit[#{rowIndex}],Item_full_name-Edit[#{rowIndex}],Item_price-Edit[#{rowIndex}]');return false;"
											value="" immediate="true" styleClass="aon-form-new-button" />
										<t:inputText id="Item_full_name-Edit" size="30"
											forceId="#{true}" styleClass="aon-form-input-text-disabled"
											value="#{deliveryDetail.to.description}" />
									</h:panelGroup>

									<f:facet name="footer">
										<t:div>
											<t:commandButton id="popupButton-New" styleClass="aon-navigation-link"
												rendered="#{deliveryDetail.new}"
												value="#{purchaseBundle.aon_purchase}"
												onclick="showPopup();return false;" />
											
											<h:panelGroup rendered="#{deliveryDetail.new}">
												<t:inputHidden id="Item_id-New" forceId="#{true}"
													value="#{deliveryDetail.to.item.id}"
													valueChangeListener="#{deliveryDetail.itemData}" />
												<t:inputText size="10" id="Item_product_code-New"
													required="true" forceId="#{true}"
													disabledOnClientSide="#{salesPurchase.withPurchase}"
													styleClass="aon-form-input-text"
													value="#{deliveryDetail.to.item.product.code}"
													onchange="return findItemLookup(event,'#{facesContext.externalContext.request.contextPath}','com.code.aon.product.Item','Item_id-New,Item_product_code-New,Item_full_name-New,Item_price-New');" />
												<h:commandButton id="findInvoice_item_new"
													rendered="#{!salesPurchase.withPurchase}"
													onclick="selectWindow(this, 'placeList', '#{itemSearch.encodedPagePath}','Item_id-New,Item_product_code-New,Item_full_name-New,Item_price-New');return false;"
													value="" immediate="true"
													styleClass="aon_button aon-form-lookup-button" />
												<h:commandButton id="addInvoice_item_new"
													rendered="#{!salesPurchase.withPurchase}"
													onclick="selectWindow(this, 'placeList', '#{itemAdd.encodedPagePath}','Item_id-New,Item_product_code-New,Item_full_name-New,Item_price-New');return false;"
													value="" immediate="true"
													styleClass="aon_button aon-form-new-button" />
												<t:inputText id="Item_full_name-New" size="30"
													forceId="#{true}" styleClass="aon-form-input-text-disabled"
													value="#{deliveryDetail.to.description}" />
											</h:panelGroup>
											<f:verbatim rendered="#{!deliveryDetail.new}">&#160;</f:verbatim>
										</t:div>
									</f:facet>
								</t:column>

								<t:column styleClass="#{deliveryDetail.to==to?'aon-table-row-selected aon-edit-table-body aon-edit-table-body-number':'aon-edit-table-body aon-edit-table-body-number'}">
									<f:facet name="header">
										<t:outputText value="#{warehouseBundle.aon_quantity}" />
									</f:facet>
									
										<t:outputText value="#{to.quantity}"
											rendered="#{to!=deliveryDetail.to}">
											<f:convertNumber pattern="#,##0.00" />
										</t:outputText>
										<t:inputText id="Item_quantity-Edit" forceId="#{true}"
											rendered="#{to==deliveryDetail.to}" size="7"
											styleClass="aon-form-input-text"
											value="#{deliveryDetail.to.quantity}" required="#{true}"
											onchange="calcPrice( #{rowIndex} );" />
									
									<f:facet name="footer">
										<t:div>
											<t:inputText id="Item_quantity-New" forceId="#{true}"
												rendered="#{deliveryDetail.new}" size="7"
												styleClass="aon-form-input-text"
												value="#{deliveryDetail.to.quantity}" required="#{true}"
												onchange="calcPrice( -1 );" />
											<f:verbatim rendered="#{!deliveryDetail.new}">&#160;</f:verbatim>
										</t:div>
									</f:facet>
								</t:column>

								<t:column styleClass="#{deliveryDetail.to==to?'aon-table-row-selected aon-edit-table-body aon-edit-table-body-number':'aon-edit-table-body aon-edit-table-body-number'}">
									<f:facet name="header">
										<t:outputText value="#{warehouseBundle.aon_price}" />
									</f:facet>
									<t:outputText value="#{to.price}"
										rendered="#{to!=deliveryDetail.to}">
										<f:convertNumber pattern="#,##0.00" />
									</t:outputText>
									<f:verbatim>&#160;</f:verbatim>
									<t:inputText id="Item_price-Edit"
										rendered="#{to==deliveryDetail.to}" forceId="#{true}"
										styleClass="aon-form-input-text" size="7"
										value="#{deliveryDetail.to.price}" required="#{true}"
										onchange="calcPrice( #{rowIndex} );" />
									<f:facet name="footer">
										<t:div>
											<t:inputText id="Item_price-New"
												rendered="#{deliveryDetail.new}" forceId="#{true}"
												styleClass="aon-form-input-text" size="7"
												value="#{deliveryDetail.to.price}" required="#{true}"
												onchange="calcPrice( -1 );" />
											<f:verbatim rendered="#{!deliveryDetail.new}">&#160;</f:verbatim>
										</t:div>
									</f:facet>
								</t:column>

								<t:column styleClass="#{deliveryDetail.to==to?'aon-table-row-selected aon-edit-table-body aon-edit-table-body-number':'aon-edit-table-body aon-edit-table-body-number'}">
									<f:facet name="header">
										<t:outputText value="#{warehouseBundle.aon_discount}" />
									</f:facet>
									<t:outputText id="Discount" forceId="#{true}"
										rendered="#{to!=deliveryDetail.to}"
										value="#{to.discountExpression.discountExpr}" />
									<t:inputText id="Discount-Edit"
										rendered="#{to==deliveryDetail.to}" forceId="#{true}"
										styleClass="aon-form-input-text" size="7"
										value="#{deliveryDetail.to.discountExpression.discountExpr}"
										required="#{true}" onchange="calcPrice( #{rowIndex} );" />
									<f:facet name="footer">
										<t:inputText id="Discount-New"
											rendered="#{deliveryDetail.new}" forceId="#{true}"
											styleClass="aon-form-input-text" size="7"
											value="#{deliveryDetail.to.discountExpression.discountExpr}"
											required="#{true}" onchange="calcPrice( -1 );" />
									</f:facet>
								</t:column>

								<t:column styleClass="#{deliveryDetail.to==to?'aon-table-row-selected aon-edit-table-body aon-edit-table-body-number':'aon-edit-table-body aon-edit-table-body-number'}">
									<f:facet name="header">
										<t:outputText value="#{warehouseBundle.aon_amount}" />
									</f:facet>
									<t:outputText id="Item_price_new-Edit"
										value="#{deliveryDetail.modelToBasePrice}" forceId="#{true}">
										<f:convertNumber pattern="#,##0.00" />
									</t:outputText>
									<f:facet name="footer">
										<t:div style="text-align:right;">
											<t:outputText id="Item_price_new-New"
												rendered="#{deliveryDetail.new}" forceId="#{true}"
												value="#{deliveryDetail.toBasePrice}" required="#{true}" />
											<t:outputText id="Item_details_total"
												rendered="#{!deliveryDetail.new}"
												value="#{deliveryDetail.taxableBase}">
												<f:convertNumber pattern="#,##0.00" />
											</t:outputText>
										</t:div>
									</f:facet>
								</t:column>
								
								<t:column styleClass="#{deliveryDetail.to==to?'aon-table-row-selected aon-edit-table-body aon-edit-table-body-buttons':'aon-edit-table-body aon-edit-table-body-buttons'}">
									<f:facet name="header">
										<f:verbatim>&#160;</f:verbatim>
									</f:facet>
									<t:div rendered="#{to==deliveryDetail.to}">
										<t:commandButton title="#{bundle.aon_save}"
											actionListener="#{deliveryDetail.onAccept}"
											styleClass="aon-edit-table-icon-button aon-edit-table-icon-button-save"
											value="" accesskey="#{bundle.aon_key_save_line}" />
										<t:commandButton title="#{bundle.aon_cancel}"
											actionListener="#{deliveryDetail.onCancel}"
											immediate="#{true}"
											onclick="return (confirm('#{bundle.aon_cancel_confirm}'));"
											styleClass="aon-edit-table-icon-button aon-edit-table-icon-button-cancel"
											value="" accesskey="#{bundle.aon_key_cancel_line}" />
										<t:commandButton title="#{bundle.aon_remove}"
											actionListener="#{deliveryDetail.onRemove}"
											immediate="#{true}"
											onclick="return (confirm('#{bundle.aon_remove_confirm}'));"
											styleClass="aon-edit-table-icon-button aon-edit-table-icon-button-delete"
											value="" accesskey="#{bundle.aon_key_remove_line}" />
									</t:div>
									<f:verbatim rendered="#{to!=deliveryDetail.to}">&#160;</f:verbatim>
									<f:facet name="footer">
										<t:div>
											<t:div rendered="#{deliveryDetail.new}">
												<t:commandButton title="#{bundle.aon_save}"
													actionListener="#{deliveryDetail.onAccept}"
													onclick="return (confirm('#{bundle.aon_accept_confirm}'));"
													styleClass="aon-edit-table-icon-button aon-edit-table-icon-button-save"
													value="" accesskey="#{bundle.aon_key_save_line}" />
												<t:commandButton title="#{bundle.aon_cancel}"
													actionListener="#{deliveryDetail.onCancel}"
													immediate="#{true}"
													onclick="return (confirm('#{bundle.aon_cancel_confirm}'));"
													styleClass="aon-edit-table-icon-button aon-edit-table-icon-button-cancel"
													value="" accesskey="#{bundle.aon_key_cancel_line}" />
											</t:div>
											<f:verbatim rendered="#{!deliveryDetail.new}">&#160;</f:verbatim>
										</t:div>
									</f:facet>
								</t:column>
							</t:dataTable>
							
							<ui:include src="/facelet/shared/dataScroller.xhtml">
								<ui:param name="dataTable" value="deliveryLineDataList" />
								<ui:param name="model" value="#{deliveryDetail.model}" />
								<ui:param name="showNote" value="#{false}" />
							</ui:include>
							
						</t:div>
					</t:div>

					<t:div id="popup" forceId="#{true}" styleClass="aon-popup-window"
						style="position: absolute;left: 290px;_left:110px; top: 230px;display:none;">
						<t:div styleClass="aon-popup-window-title">
								<t:commandButton id="popupClose" value=" "
								immediate="true" styleClass="aon-popup-window-close"
								onclick="hidePopup(); return false;"
								accesskey="#{bundle.aon_key_close}" />
					
							<t:outputLabel 
							value="#{purchaseBundle.aon_purchase}" />
							
						</t:div>
						<t:div styleClass="aon-popup-window-body">
							<t:div styleClass="aon-content-toolbar" id="aon-content-toolbar"
								forceId="#{true}">
									<t:div styleClass="aon-content-toolbar-internal">
										<t:commandButton id="popupUpdate" value="#{bundle.aon_accept}"
											actionListener="#{salesPurchase.onSave}"
											onclick="return validate('false');"
											styleClass="aon-content-toolbar-item aon-content-toolbar-item-save"
											onmouseover="this.className='aon-content-toolbar-item aon-content-toolbar-item-hover aon-content-toolbar-item-save'"
											onmouseout="this.className='aon-content-toolbar-item aon-content-toolbar-item-save'"
											accesskey="#{bundle.aon_key_accept}" />
										<t:commandButton id="popupDelete" value="#{bundle.aon_remove}"
											actionListener="#{salesPurchase.onRemove}"
											rendered="#{salesPurchase.to.purchaseDetail.id != null}"
											styleClass="aon-content-toolbar-item aon-content-toolbar-item-remove"
											onmouseover="this.className='aon-content-toolbar-item aon-content-toolbar-item-hover aon-content-toolbar-item-remove'"
											onmouseout="this.className='aon-content-toolbar-item aon-content-toolbar-item-remove'" />
										
									</t:div>
								</t:div>
							<t:div styleClass="aon-popup-window-scroll-area">
								<h:panelGrid columns="2" styleClass="aon-form-table" 
								columnClasses="aon-form-table-column-odd,aon-form-table-column-even" >
									<t:outputLabel for="Income_series" styleClass="aon-form-input-text-label"
										value="#{purchaseBundle.aon_inc_num}" />
									<t:div>
										<t:inputText id="Income_series" styleClass="aon-form-input-text"
											forceId="#{true}" size="3" maxlength="3"
											onblur="toUpperCase(this);"
											value="#{salesPurchase.to.purchaseDetail.purchase.series}">
											<f:validateLength maximum="3" />
										</t:inputText>
										<t:inputText id="Income_number" styleClass="aon-form-input-text"
											forceId="#{true}"
											value="#{salesPurchase.to.purchaseDetail.purchase.number}" />
										<t:outputText id="Number_required" forceId="#{true}"
											value="#{purchaseBundle.aon_income_number_required}"
											style="display:none;color:#cc3333" />
									</t:div>
									<t:outputLabel for="Supplier_id" styleClass="aon-form-input-text-label"
										value="#{purchaseBundle.aon_supplier}" />
									<t:div styleClass="aon-form-nowrap">
										<t:inputText id="Supplier_id" size="5" forceId="#{true}"
											styleClass="aon-form-input-text"
											onchange="return findSupplierLookup(event,'#{facesContext.externalContext.request.contextPath}','com.code.aon.purchase.Supplier','Supplier_id,Supplier_full_name');"
											value="#{salesPurchase.to.purchaseDetail.purchase.supplier.id}" />
										<h:commandButton id="findSupplier"
											styleClass="aon-form-lookup-button"
											onclick="selectWindow(this, 'placeList', '#{supplierSearch.encodedPagePath}','Supplier_id,Supplier_full_name');return false;"
											value="" immediate="true" />
										<h:commandButton id="addSupplier"
											styleClass="aon-form-new-button"
											onclick="selectWindow(this, 'placeList', '#{supplierAdd.encodedPagePath}','Supplier_id,Supplier_full_name');return false;"
											value="" immediate="true" />
										<t:inputText id="Supplier_full_name" forceId="#{true}"
											styleClass="aon-form-input-text-disabled" disabled="true"
											size="30"
											value="#{salesPurchase.to.purchaseDetail.purchase.supplier.name} #{salesPurchase.to.purchaseDetail.purchase.supplier.surname==null?' ':(salesPurchase.to.purchaseDetail.purchase.supplier.surname)}" />
										<t:outputText id="Supplier_required" forceId="#{true}"
											value="#{purchaseBundle.aon_income_supplier_required}"
											style="display:none;color:#cc3333" />
									</t:div>
		
									<t:outputLabel for="Income_issueTime" styleClass="aon-form-input-text-label"
										value="#{purchaseBundle.aon_date}" />
									<t:div styleClass="aon-form-nowrap">
										<t:inputText styleClass="aon-form-input-text"
											id="Income_issueTime" forceId="#{true}" size="10"
											maxlength="12"
											value="#{salesPurchase.to.purchaseDetail.purchase.issueDate}">
											<f:convertDateTime pattern="#{bundle.aon_date_pattern}"
												timeZone="#{timeZoneController.timeZoneId}" />
										</t:inputText>
										<t:commandButton styleClass="aon-form-calendar-button"
											id="Income_issueTime_button" forceId="#{true}" value=""
											immediate="true" />
										<t:outputText id="Date_required" forceId="#{true}"
											value="#{purchaseBundle.aon_income_date_required}"
											styleClass="aon-form-input-text-disabled"
											 />
										<script type="text/javascript">
										  Calendar.setup( {
											inputField  : "Income_issueTime", button : "Income_issueTime_button",
											ifFormat    : "%d/%m/%Y" } );
										</script>
									</t:div>
									
									<t:outputLabel for="IncomeDetail_warehouse_id"
										styleClass="aon-form-selectOneMenu-label"
										value="#{warehouseBundle.aon_warehouse}" />
									<t:selectOneMenu id="IncomeDetail_warehouse_id" 
										styleClass="aon-form-selectOneMenu-field" forceId="#{true}"
										value="#{salesPurchase.purchaseWarehouseId}">
										<f:selectItems value="#{warehouseCollections.warehouses}" />
									</t:selectOneMenu>
		
									<t:outputLabel for="Item_id-Popup" styleClass="aon-form-input-text-label"
										value="#{productBundle.item_item}" />
									<t:div styleClass="aon-form-nowrap">
										<t:inputHidden id="Item_id-Popup" forceId="#{true}"
											value="#{salesPurchase.to.purchaseDetail.item.id}" />
										<t:inputHidden id="Item_product_id-Popup" forceId="#{true}"
											value="#{salesPurchase.to.purchaseDetail.item.product.id}" />
										<t:inputText size="10" id="Item_product_code-Popup"
											forceId="#{true}"
											value="#{salesPurchase.to.purchaseDetail.item.product.code}"
											styleClass="aon-form-input-text" onblur="toUpperCase(this);"
											onchange="return findItemCreationLookup(event,'#{facesContext.externalContext.request.contextPath}','com.code.aon.product.Item','Item_id-Popup,Item_product_code-Popup,Item_full_name-Popup,Item_price-Popup,Item_purchase_price-Popup,Item_product_category_id-Popup,Item_product_id-Popup');" />
										<h:commandButton id="findPopup_Item"
											onclick="selectWindow(this, 'placeList', '#{itemSearch.encodedPagePath}', 'Item_id-Popup,Item_product_code-Popup,Item_full_name-Popup,Item_price-Popup,Item_purchase_price-Popup,Item_product_category_id-Popup,Item_product_id-Popup'); return false;"
											action="showPlace" value="" immediate="true"
											styleClass="aon-form-lookup-button" />
										<h:commandButton id="addPopup_Item"
											onclick="selectWindow(this, 'placeList', '#{itemAdd.encodedPagePath}', 'Item_id-Popup,Item_product_code-Popup,Item_full_name-Popup,Item_price-Popup,Item_purchase_price-Popup,Item_product_category_id-Popup,Item_product_id-Popup'); return false;"
											action="showPlace" value="" immediate="true"
											styleClass="aon-form-new-button" />
										<t:inputText id="Item_full_name-Popup" size="36"
											forceId="#{true}" styleClass="aon-form-input-text"
											value="#{salesPurchase.to.purchaseDetail.description}" />
										<t:outputText id="Product_code_required" forceId="#{true}"
											value="#{productBundle.aon_product_code_required}"
											style="display:none;color:#cc3333" />
										<t:outputText id="Product_name_required" forceId="#{true}"
											value="#{productBundle.aon_product_name_required}"
											style="display:none;color:#cc3333" />
									</t:div>
		
									<t:outputLabel for="Item_product_category_id-Popup" styleClass="aon-form-input-text-label"
										value="#{productBundle.item_category}" />
									<h:panelGrid columns="3">	
										<t:selectOneMenu id="Item_product_category_id-Popup" forceId="#{true}"
											styleClass="aon-form-selectOneMenu-field"
											value="#{salesPurchase.to.purchaseDetail.item.product.category.id}">
											<f:selectItems value="#{productCollections.categories}" />
										</t:selectOneMenu>
										<t:outputText id="Item_product_category_required" forceId="#{true}"
											value="#{productBundle.aon_category_required}"
											style="display:none;color:#cc3333" />
									</h:panelGrid>	
		
									<t:outputLabel for="Item_price-Popup" styleClass="aon-form-input-text-label"
										value="#{productBundle.item_price}" />
									<t:inputText id="Item_price-Popup"
										styleClass="aon-form-input-text" required="true"
										forceId="#{true}" size="20" maxlength="20"
										value="#{salesPurchase.to.purchaseDetail.item.price}" />
		
									<t:outputLabel for="Item_purchase_price-Popup" styleClass="aon-form-input-text-label"
										value="#{productBundle.item_initialPrice}" />
									<t:inputText id="Item_purchase_price-Popup"
										styleClass="aon-form-input-text" required="true"
										forceId="#{true}" size="20" maxlength="20"
										value="#{salesPurchase.to.purchaseDetail.item.purchasePrice}" />
		
									<t:outputLabel for="Item_quantity-Popup" styleClass="aon-form-input-text-label"
										value="#{warehouseBundle.aon_quantity}" />
									<t:inputText id="Item_quantity-Popup"
										styleClass="aon-form-input-text" required="true"
										forceId="#{true}" size="20" maxlength="20"
										value="#{salesPurchase.to.purchaseDetail.quantity}" />
								</h:panelGrid>
							</t:div>
						</t:div>
					</t:div>
				</t:div>
			</t:div>
			<t:inputHidden id="withPurchase"
				value="#{salesPurchase.withPurchase}" forceId="#{true}" />
		</h:form>
		<script>
			function calcPrice(index){		
				priceName = "Item_price";
				quantityName = "Item_quantity";
				priceNewName = "Item_price_new"
				discountName = "Discount";
				if(index != -1){
					priceName = priceName + "-Edit[" + index + "]";
					quantityName = quantityName + "-Edit[" + index + "]";
					priceNewName = priceNewName + "-Edit[" + index + "]";
					discountName = discountName + "-Edit[" + index + "]";
				}else{
					priceName = priceName + "-New";
					quantityName = quantityName + "-New";
					priceNewName = priceNewName + "-New";
					discountName = discountName + "-New";					
				}
				price = document.getElementById( priceName );
				quantity = document.getElementById( quantityName );
				discount = document.getElementById( discountName );
				amount = document.getElementById( priceNewName );
				temp = redondea( price.value * quantity.value , 2 );
				amount.innerText = "" + redondea( temp - ( temp * discount.value / 100 ), 2 );
			}
			function isUnsignedInteger(number) {
				var Template = /^\d+$/ 
				res = (Template.test(number)) ? true : false
				return res;
			}
			function showPopup(){
				document.getElementById( "popup" ).style.display='block';
				document.getElementById( "Number_required" ).style.display = 'none';
				document.getElementById( "Supplier_required" ).style.display = 'none';
				document.getElementById( "Date_required" ).style.display = 'none';
				document.getElementById( "Product_code_required" ).style.display = 'none';
				document.getElementById( "Product_name_required" ).style.display = 'none';
				document.getElementById( "Item_product_category_required" ).style.display = 'none';
				if(document.getElementById("Supplier_id").value != ""){
					document.getElementById( "IncomeDetail_warehouse_id" ).disabled = true;
				}
				document.getElementById( "Income_series" ).focus();
			}
			function hidePopup(){
				document.getElementById( "IncomeDetail_warehouse_id" ).disabled = false;
				document.getElementById( "popup" ).style.display='none';
				document.getElementById( "Number_required" ).style.display = 'none';
				document.getElementById( "Supplier_required" ).style.display = 'none';
				document.getElementById( "Date_required" ).style.display = 'none';
				document.getElementById( "Product_code_required" ).style.display = 'none';
				document.getElementById( "Item_product_category_required" ).style.display = 'none';
				document.getElementById( "Product_name_required" ).style.display = 'none';
			}
			function validate(isNew){ 
				if(document.getElementById( "Income_number" ).value == ""){
					document.getElementById( "Number_required" ).style.display = 'block';
					document.getElementById( "Supplier_required" ).style.display = 'none';
					document.getElementById( "Date_required" ).style.display = 'none';
					document.getElementById( "Product_code_required" ).style.display = 'none';
					document.getElementById( "Product_name_required" ).style.display = 'none';
					document.getElementById( "Item_product_category_required" ).style.display = 'none';
					document.getElementById( "Income_number" ).focus();
					return false;
				}
				if(document.getElementById( "Supplier_id" ).value == ""){
					document.getElementById( "Supplier_required" ).style.display = 'block';
					document.getElementById( "Number_required" ).style.display = 'none';
					document.getElementById( "Date_required" ).style.display = 'none';
					document.getElementById( "Product_code_required" ).style.display = 'none';
					document.getElementById( "Product_name_required" ).style.display = 'none';
					document.getElementById( "Item_product_category_required" ).style.display = 'none';					
					document.getElementById( "Supplier_id" ).focus();
					return false;
				}
				if(document.getElementById( "Income_issueTime" ).value == ""){
					document.getElementById( "Date_required" ).style.display = 'block';
					document.getElementById( "Number_required" ).style.display = 'none';
					document.getElementById( "Supplier_required" ).style.display = 'none';
					document.getElementById( "Product_code_required" ).style.display = 'none';
					document.getElementById( "Product_name_required" ).style.display = 'none';
					document.getElementById( "Item_product_category_required" ).style.display = 'none';
					document.getElementById( "Income_issueTime" ).focus();
					return false;
				}
				if(document.getElementById( "Item_product_code-Popup" ).value == ""){
					document.getElementById( "Product_code_required" ).style.display = 'block';
					document.getElementById( "Date_required" ).style.display = 'none';
					document.getElementById( "Number_required" ).style.display = 'none';
					document.getElementById( "Supplier_required" ).style.display = 'none';
					document.getElementById( "Product_name_required" ).style.display = 'none';
					document.getElementById( "Item_product_category_required" ).style.display = 'none';
					document.getElementById( "Item_product_code-Popup" ).focus();
					return false;
				}
				if(document.getElementById( "Item_full_name-Popup" ).value == ""){
					document.getElementById( "Product_name_required" ).style.display = 'block';
					document.getElementById( "Date_required" ).style.display = 'none';
					document.getElementById( "Number_required" ).style.display = 'none';
					document.getElementById( "Supplier_required" ).style.display = 'none';
					document.getElementById( "Product_code_required" ).style.display = 'none';
					document.getElementById( "Item_product_category_required" ).style.display = 'none';
					document.getElementById( "Item_full_name-Popup" ).focus();
					return false;
				}
				if(document.getElementById( "Item_product_category_id-Popup" ).value == ""){
					document.getElementById( "Item_product_category_required" ).style.display = 'block';
					document.getElementById( "Product_name_required" ).style.display = 'none';
					document.getElementById( "Date_required" ).style.display = 'none';
					document.getElementById( "Number_required" ).style.display = 'none';
					document.getElementById( "Supplier_required" ).style.display = 'none';
					document.getElementById( "Product_code_required" ).style.display = 'none';
					document.getElementById( "Item_product_category_id-Popup" ).focus();
					return false;
				}
				document.getElementById( "Product_code_required" ).style.display = 'none';
				document.getElementById( "Product_name_required" ).style.display = 'none';
				document.getElementById( "Number_required" ).style.display = 'none';
				document.getElementById( "Supplier_required" ).style.display = 'none';
				document.getElementById( "Date_required" ).style.display = 'none';
				document.getElementById( "Item_product_category_required" ).style.display = 'none';
				if(isNew){
					document.getElementById( "Item_product_code-New" ).disabled = true;
				}
				return true;
			}
			function disableRequiredFields(){
				document.getElementById( "Product_code_required" ).disabled = true;
				document.getElementById( "Product_name_required" ).disabled = true;
				document.getElementById( "Delivery_number" ).disabled = true;
				document.getElementById( "Delivery_issueTime" ).disabled = true;
				document.getElementById( "Customer_id" ).disabled = true;
			}
			function enableEmployee( supportOrderDrop ){
				if( supportOrderDrop == null ){
					document.getElementById( "SupportOrder_employee_id" ).disabled = false;
				}else{
					if(supportOrderDrop.value == ""){
						document.getElementById( "SupportOrder_employee_id" ).disabled = true;
					}else{
						document.getElementById( "SupportOrder_employee_id" ).disabled = false;
					}
				}	
			}
			function validateAndLookup( object ){
				if( object.value == ""){
					document.getElementById( "save" ).disabled = false;
					document.getElementById( "SupportOrder_description" ).value = "";
					enableEmployee(object);
					return false;
				}
				document.getElementById( "save" ).disabled = true;
				enableEmployee(object);
				return findSupportOrderLookup(event,'#{facesContext.externalContext.request.contextPath}','com.code.aon.tas.SupportOrder');
			}
			enableEmployee(document.getElementById( "SupportOrder_id" ));
			/*window.onload=focusTableRow;*/
		</script>
		<h:form id="placeList" target="list" />
	</ui:define>
</ui:composition>
</body>
</html>
